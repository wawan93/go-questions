## Что такое интерфейс

Интерфейс в Go — это тип, определяющий набор методов без их реализации. Любой тип, реализующий эти методы, неявно соответствует интерфейсу (duck-typing).

```go
type Reader interface {
	Read(p []byte) (n int, err error)
}
```

## Внутреннее устройство интерфейса

Интерфейс (`interface{}`) в Go — это структура из двух указателей:

```go

type iface struct {
	tab *itab // информация о методах и типе
	data unsafe.Pointer // указатель на данные
}
```

- Копирование интерфейса копирует `tab` и `data`.
- Если внутри `interface{}` лежит указатель — работаете с оригиналом.
- Если лежит значение (struct) — работаете с копией.

## Подводные камни

1. **nil vs interface со значением nil**
```go
var err error = (*MyError)(nil)
fmt.Println(err == nil) // false
```

2. **Копирование значений**
```go
type S struct { x int }

func change(i interface{}) {
	i.(S).x = 10 // panic
}
```

3. **Отсутствие информации о типе**
```go
i := interface{}(123)
fmt.Println(i + 1) // ошибка компиляции
```

## Часто задаваемые вопросы

- Что такое интерфейс и зачем нужен?

- Неявная имплементация (duck-typing).

- Отличие `interface{}` от `*interface{}`.

- Почему `interface != nil`, хотя `data == nil`.

## Задачи "что выведет код"

### Задача 1

```go
type MyError struct{}

func (e *MyError) Error() string { return "oops" }

func test() error {
	var err *MyError = nil
	return err
}

func main() {
	if test() == nil {
		fmt.Println("nil")
	} else {
		fmt.Println("not nil")
	}
}
```

**Ответ:** not nil, потому что интерфейс содержит тип `*MyError`, хоть и `nil` значение
### Задача 2

```go
type T struct{ Name string }

func change(i interface{}) {
	t := i.(T)
	t.Name = "Bob"
}

func main() {
	t := T{"Alice"}
	change(t)
	fmt.Println(t.Name)
}
```

**Ответ:** Alice. Потому что в `interface{}` передаётся копия `T`.
**Как исправить:** передать `*T`, и изменить через указатель.

### Задача 3

```go

var i interface{}

fmt.Println(i == nil) // true

var s *string = nil

i = s

fmt.Println(i == nil) // false

```

[[Интерфейс error]]